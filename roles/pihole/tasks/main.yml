---

#
# Supported Vars:
#   - TIMEZONE: Defaults to "Asia/Kolkatta"
#   - ENABLE_IPV6: Defaults to "true"
#   - DNS_LISTENING_MODE: Defaults to "all"
#   - DHCP_ACTIVE: Defaults to "true"
#   - DHCP_START: Required. Eg: "192.168.86.40"
#   - DHCP_END: Required. Eg: "192.168.86.250"
#   - DHCP_ROUTER: Required. Eg: "192.168.86.1"
#   - CUSTOM_DNS_NAMES: Required. Eg: "192.168.86.2 foo.com;192.168.86.2 bar.com"
#   - DNS_UPSTREAMS: Defaults to: "8.8.8.8;8.8.4.4"
#   - PIHOLE_CONTAINER: Defaults to "pihole/pihole:latest"
#   - PIHOLE_SERVER_HOST: Required. Eg: pihole.foo.com
#
# Env vars:
#   - PI_HOLE_ADMIN_PASSWD: Required. Admin password.
#

- name: Install Pihole container
  include_role:
    name: supersaiyanmode.ansible_utils.install_docker_image
  vars:
    container_name: pihole
    container_image: "{{ PIHOLE_CONTAINER }}"
    server_host: "{{ PIHOLE_SERVER_HOST }}"
    main_port: 10080
    image_pull: true
    container_mounts:
      - /etc/pihole
      - /etc/dnsmasq.d
    capabilities:
      - NET_ADMIN
    env:
      TZ: "{{ TIMEZONE }}"
      FTLCONF_dhcp_active: "{{ DHCP_ACTIVE }}"
      FTLCONF_dhcp_ipv6: "true"
      FTLCONF_webserver_port: '10080,10081s'
      FTLCONF_dhcp_start: "{{ DHCP_START }}"
      FTLCONF_dhcp_end: "{{ DHCP_END }}"
      FTLCONF_dhcp_router: "{{ DHCP_ROUTER }}"
      FTLCONF_dns_listeningMode: "all"
      FTLCONF_dns_hosts: "{{ CUSTOM_DNS_NAMES }}"
      FTLCONF_dns_upstreams: "{{ DNS_UPSTREAMS }}"
      FTLCONF_webserver_api_password: "{{ lookup('env', 'PI_HOLE_ADMIN_PASSWD') }}"

